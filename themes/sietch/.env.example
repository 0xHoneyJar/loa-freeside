# Sietch Service Environment Configuration
# Copy this file to .env.local for development
#
# ⚠️ SECURITY: Never commit .env.local or any file with real secrets!
#
# HOW TO GET DISCORD IDs:
# 1. Open Discord Settings > Advanced > Enable "Developer Mode"
# 2. Right-click any server/channel/role > "Copy ID"
# 3. IDs are 18-19 digit numbers (Snowflake format), e.g., 1234567890123456789
#
# For detailed setup instructions, see: docs/ADMIN_SETUP_GUIDE.md

# =============================================================================
# BERACHAIN RPC CONFIGURATION
# =============================================================================

# Comma-separated list of Berachain RPC endpoint URLs (for resilience/fallback)
# Primary endpoint is tried first, others are used as fallback
BERACHAIN_RPC_URLS=https://rpc.berachain.com,https://rpc-backup.berachain.com

# BGT token contract address on Berachain mainnet
# Mainnet: 0x656b95E550C07a9ffe548bd4085c72418Ceb1dba
BGT_ADDRESS=0x656b95E550C07a9ffe548bd4085c72418Ceb1dba

# DEPRECATED: Reward vault addresses are no longer used
# Eligibility is now determined by balanceOf(wallet) + burn detection (Transfer to 0x0)
# REWARD_VAULT_ADDRESSES=

# =============================================================================
# TRIGGER.DEV CONFIGURATION
# =============================================================================

# trigger.dev project ID
TRIGGER_PROJECT_ID=sietch-service

# trigger.dev secret key (from dashboard)
TRIGGER_SECRET_KEY=tr_dev_xxxxxxxxxxxxxxxxxxxxx

# =============================================================================
# DISCORD BOT CONFIGURATION (REQUIRED)
# =============================================================================
# See docs/ADMIN_SETUP_GUIDE.md for detailed Discord setup instructions

# [REQUIRED] Discord bot token from Developer Portal
# Get from: https://discord.com/developers/applications > Your App > Bot > Token
# Format: Base64-encoded bot ID + timestamp + HMAC (looks like: MTIz...XXX.XXXXXX.XXXX...)
DISCORD_BOT_TOKEN=your_bot_token_here

# [REQUIRED] Your Discord server (guild) ID
# Right-click server name > Copy Server ID
DISCORD_GUILD_ID=1234567890123456789

# [REQUIRED] Channel IDs - right-click channel > Copy Channel ID
DISCORD_CHANNEL_THE_DOOR=1234567890123456790
DISCORD_CHANNEL_CENSUS=1234567890123456791

# [OPTIONAL] Social Layer Channels (v2.0)
# Leave as empty string or omit if not using these channels
DISCORD_CHANNEL_SIETCH_LOUNGE=
DISCORD_CHANNEL_NAIB_COUNCIL=
DISCORD_CHANNEL_INTRODUCTIONS=

# [OPTIONAL] Cave Entrance Channel (v2.1)
# Channel for aspiring members in positions 70-100 to view threshold requirements
DISCORD_CHANNEL_CAVE_ENTRANCE=

# [OPTIONAL] The Oasis Channel (v3.0)
# Exclusive channel for Water Sharer badge holders
DISCORD_CHANNEL_OASIS=

# [OPTIONAL] Announcements Channel (v3.0)
# Channel for weekly community digest posts
DISCORD_CHANNEL_ANNOUNCEMENTS=

# [OPTIONAL] Deep Desert Channel (v3.0)
# Exclusive channel for Engaged badge holders (5+ badges)
DISCORD_CHANNEL_DEEP_DESERT=

# [OPTIONAL] Stillsuit Lounge Channel (v3.0)
# Exclusive channel for Veteran badge holders (90+ days)
DISCORD_CHANNEL_STILLSUIT_LOUNGE=

# [REQUIRED] Core Role IDs - right-click role in Server Settings > Copy Role ID
DISCORD_ROLE_NAIB=1234567890123456792
DISCORD_ROLE_FEDAYKIN=1234567890123456793

# [OPTIONAL] Cave Entrance Role (v2.1)
# Role assigned to waitlist registrations, gives access to Cave Entrance channels
DISCORD_ROLE_TAQWA=

# [OPTIONAL] Former Naib Role (v2.1)
# Role assigned to members who were previously Naib but were bumped
DISCORD_ROLE_FORMER_NAIB=

# [OPTIONAL] Water Sharer Role (v3.0)
# Role assigned to Water Sharer badge holders (can share badge with one member)
DISCORD_ROLE_WATER_SHARER=

# [OPTIONAL] Engaged Role (v3.0)
# Role assigned to members with 5+ badges earned
DISCORD_ROLE_ENGAGED=

# [OPTIONAL] Veteran Role (v3.0)
# Role assigned to members with 90+ days tenure
DISCORD_ROLE_VETERAN=

# =============================================================================
# TIER ROLES (v3.0) - [OPTIONAL]
# =============================================================================
# 9-tier system roles assigned based on BGT holdings
# Colors: Hajra=Sand, Ichwan=Orange, Qanat=Cyan, Sihaya=Green,
#         Mushtamal=Teal, Sayyadina=Indigo, Usul=Purple
# Note: Fedaykin (Blue) and Naib (Gold) are rank-based, not BGT threshold
# See docs/TIER_SYSTEM.md for full tier documentation

# [OPTIONAL] Tier 0: Hajra - 6.9+ BGT - Journey of seeking
DISCORD_ROLE_HAJRA=

# [OPTIONAL] Tier 1: Ichwan - 69+ BGT - Brotherhood
DISCORD_ROLE_ICHWAN=

# [OPTIONAL] Tier 2: Qanat - 222+ BGT - Underground water channels
DISCORD_ROLE_QANAT=

# [OPTIONAL] Tier 3: Sihaya - 420+ BGT - Desert spring
DISCORD_ROLE_SIHAYA=

# [OPTIONAL] Tier 4: Mushtamal - 690+ BGT - Inner garden of the sietch
DISCORD_ROLE_MUSHTAMAL=

# [OPTIONAL] Tier 5: Sayyadina - 888+ BGT - Fremen priestess rank
DISCORD_ROLE_SAYYADINA=

# [OPTIONAL] Tier 6: Usul - 1111+ BGT - Base of the pillar
DISCORD_ROLE_USUL=

# =============================================================================
# API CONFIGURATION
# =============================================================================

# Port for Express server
API_PORT=3000

# Host to bind to (use 127.0.0.1 for production behind nginx)
API_HOST=0.0.0.0

# =============================================================================
# API KEY SECURITY (Sprint 73: HIGH-1)
# =============================================================================
# Admin API keys support two formats:
#
# 1. LEGACY (plaintext - for development only, migrate to bcrypt):
#    ADMIN_API_KEYS=plaintext_key:admin1,another_key:admin2
#
# 2. SECURE (bcrypt hash - REQUIRED for production):
#    ADMIN_API_KEYS=$2b$12$hash1...:admin1,$2b$12$hash2...:admin2
#
# To generate bcrypt-hashed keys:
# 1. Start the server with an existing admin key
# 2. Call POST /admin/api-keys/rotate with body:
#    {"admin_name": "deploy_bot", "grace_period_hours": 24}
# 3. Copy the returned key_hash and env_format values
# 4. Update this env var with the new bcrypt hash

# Comma-separated admin API keys in format hash:name or key:name
# Example (development only): dev_key:developer
# Example (production): $2b$12$xxxxxxxxxxx:deploy_bot
ADMIN_API_KEYS=dev_key:developer

# Required pepper for API key hashing (used with HMAC-SHA256)
# Generate: openssl rand -hex 32
# SECURITY: Must be set in production, keep secret, rotate periodically
API_KEY_PEPPER=CHANGE_ME_IN_PRODUCTION

# =============================================================================
# DATABASE CONFIGURATION (Sprint 70: PostgreSQL + RLS Migration)
# =============================================================================

# PostgreSQL connection URL (REQUIRED for production)
# Format: postgresql://user:password@host:port/database
# Docker Compose: postgresql://arrakis:arrakis@localhost:5432/arrakis
# Neon/Supabase: postgres://user:password@ep-xxx.region.neon.tech/arrakis?sslmode=require
DATABASE_URL=postgresql://arrakis:arrakis@localhost:5432/arrakis

# SQLite database file path (DEPRECATED - for migration only)
# PostgreSQL with RLS is required for production multi-tenant isolation
# DATABASE_PATH=./data/sietch.db

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# =============================================================================
# GRACE PERIOD CONFIGURATION
# =============================================================================

# Hours before entering grace period (no revocations during RPC outage)
GRACE_PERIOD_HOURS=24

# =============================================================================
# SOCIAL LAYER CONFIGURATION (v2.0)
# =============================================================================

# Activity Decay Settings
# Decay rate per period (0.0-1.0, default 0.1 = 10%)
ACTIVITY_DECAY_RATE=0.1
# Decay period in hours (default 6)
ACTIVITY_DECAY_PERIOD_HOURS=6
# Points per activity type
ACTIVITY_POINTS_MESSAGE=1
ACTIVITY_POINTS_REACTION_GIVEN=1
ACTIVITY_POINTS_REACTION_RECEIVED=2

# Profile Settings
# Cooldown for nym changes in days (default 30)
NYM_CHANGE_COOLDOWN_DAYS=30
# Launch date for OG badge calculation (ISO 8601 format)
# SOCIAL_LAYER_LAUNCH_DATE=2025-01-01T00:00:00Z
# Max bio length in characters (default 160)
MAX_BIO_LENGTH=160

# Avatar Settings (Drunken Bishop Algorithm)
# Default avatar size in pixels (default 200)
AVATAR_DEFAULT_SIZE=200
# Grid dimensions (default 17x9)
AVATAR_GRID_WIDTH=17
AVATAR_GRID_HEIGHT=9

# Image Processing Settings
# Target PFP size in pixels (default 256)
PFP_SIZE=256
# Max PFP file size in KB (default 500)
MAX_PFP_SIZE_KB=500
# WebP compression quality 1-100 (default 80)
WEBP_QUALITY=80

# =============================================================================
# PADDLE CONFIGURATION (v5.0 - Sprint 2 Paddle Migration)
# =============================================================================
# Required for Paddle billing integration

# Paddle API key (from Paddle Dashboard > Developer Tools > API keys)
# Use sandbox API key for development, production key for live
PADDLE_API_KEY=pdl_xxxxxxxxxxxxxxxxxxxxx

# Paddle webhook secret (from Paddle Dashboard > Developer Tools > Notifications)
# Create a webhook endpoint pointing to /api/billing/webhook
PADDLE_WEBHOOK_SECRET=pdl_ntfset_xxxxxxxxxxxxxxxxxxxxx

# Paddle environment: sandbox or production
PADDLE_ENVIRONMENT=sandbox

# Paddle client-side token (for Paddle.js checkout)
# From Paddle Dashboard > Developer Tools > Client-side tokens
PADDLE_CLIENT_TOKEN=live_xxxxxxxxxxxxxxxxxxxxx

# Paddle price IDs for subscription tiers
# Format: "tier:price_id,tier:price_id"
# Example: "basic:pri_xxx,premium:pri_yyy,exclusive:pri_zzz"
PADDLE_PRICE_IDS=basic:pri_xxx,premium:pri_xxx,exclusive:pri_xxx,elite:pri_xxx

# Paddle one-time purchase price IDs
# Price IDs for badge and boost one-time purchases
PADDLE_BADGE_PRICE_ID=pri_badge_xxx
PADDLE_BOOST_PRICE_ID=pri_boost_xxx

# =============================================================================
# REDIS CONFIGURATION (v4.0 - Sprint 23)
# =============================================================================
# Required for entitlement caching and webhook deduplication

# Redis connection URL (Upstash Redis recommended)
# Format: redis://username:password@host:port or rediss:// for TLS
REDIS_URL=rediss://default:xxxxx@xxx.upstash.io:6379

# Maximum retry attempts for Redis operations (default: 3)
REDIS_MAX_RETRIES=3

# Connection timeout in milliseconds (default: 5000)
REDIS_CONNECT_TIMEOUT=5000

# Entitlement cache TTL in seconds (default: 300 = 5 minutes)
REDIS_ENTITLEMENT_TTL=300

# =============================================================================
# FEATURE FLAGS (v5.0 - Sprint 2 Paddle Migration)
# =============================================================================
# Control which features are enabled

# Enable Paddle billing integration (default: false)
# Set to true when Paddle is configured and ready
FEATURE_BILLING_ENABLED=false

# Enable Gatekeeper feature gating (default: false)
# Set to true to enforce subscription-based feature access
FEATURE_GATEKEEPER_ENABLED=false

# Enable Redis caching (default: false)
# Set to true when Redis is configured and ready
FEATURE_REDIS_ENABLED=false

# Enable Telegram bot (default: false)
# Set to true when Telegram is configured and ready
FEATURE_TELEGRAM_ENABLED=false

# Enable Vault secrets management (default: false)
# Set to true when HashiCorp Vault is configured and ready
# SECURITY: Vault is required for production-grade secret management
FEATURE_VAULT_ENABLED=false

# =============================================================================
# VAULT CONFIGURATION (Sprint 71: CRIT-2 - Vault Transit Integration)
# =============================================================================
# Required for HSM-backed signing and secure secrets management
# In production, sensitive secrets should be stored in Vault KV, not env vars

# Vault server address
# Development: http://localhost:8200
# Production: https://vault.honeyjar.xyz
VAULT_ADDR=http://localhost:8200

# Vault authentication token
# SECURITY: In production, use AppRole or Kubernetes auth instead of static tokens
# Development: Root token from 'vault server -dev'
VAULT_TOKEN=hvs.xxxxxxxxxxxxxxxxxxxxx

# Vault namespace (optional, for Vault Enterprise)
# VAULT_NAMESPACE=honeyjar

# Default signing key name in Vault Transit
# The key must exist: vault write transit/keys/arrakis-signing type=ecdsa-p256
VAULT_SIGNING_KEY_NAME=arrakis-signing

# Request timeout in milliseconds (default: 5000)
VAULT_REQUEST_TIMEOUT=5000

# Secret cache TTL in seconds (default: 3600 = 1 hour)
# Secrets from Vault KV are cached to reduce API calls
VAULT_SECRET_CACHE_TTL=3600

# =============================================================================
# WALLET VERIFICATION (Sprint 172 - In-House EIP-191)
# =============================================================================
# In-house wallet verification using EIP-191 (personal_sign) signatures
# Replaces Collab.Land for native wallet linking
#
# REQUIRES: PostgreSQL configured (DATABASE_URL) for session storage

# Base URL for wallet verification pages (REQUIRED)
# This is where users are redirected to connect their wallet and sign
# Development: http://localhost:3000 (or your local API server)
# Production: https://api.sietch.community (your public API URL)
VERIFY_BASE_URL=http://localhost:3000

# Session expiry in minutes (default: 15)
# How long a verification session remains valid before timing out
VERIFY_SESSION_EXPIRY_MINUTES=15

# =============================================================================
# TELEGRAM CONFIGURATION (v4.1 - Sprint 30)
# =============================================================================
# Required for Telegram bot integration

# Telegram bot token from @BotFather
# Create a bot: https://t.me/BotFather -> /newbot
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklmnOPQrstuvWXYZ

# Webhook secret token for validating requests from Telegram
# Generate a random string (32+ chars recommended)
# Required in production (webhook mode)
TELEGRAM_WEBHOOK_SECRET=your_random_webhook_secret_here

# Public webhook URL where Telegram sends updates
# Only set in production - leave empty for development (uses polling)
# Format: https://your-domain.com/telegram/webhook
# TELEGRAM_WEBHOOK_URL=https://api.example.com/telegram/webhook

# =============================================================================
# DUNE SIM API CONFIGURATION (Sprint 14: RPC Replacement)
# =============================================================================
# Dune Sim provides unified blockchain data API replacing direct RPC calls.
# Get an API key from https://sim.dune.com/
#
# Benefits:
# - Eliminates RPC rate limiting issues
# - Multi-chain queries with single API
# - USD pricing for token balances
# - NFT ownership with spam filtering
# - Transaction activity history

# Dune Sim API key (REQUIRED for dune_sim/hybrid provider modes)
# Get from: https://sim.dune.com/settings/api-keys
DUNE_SIM_API_KEY=

# Dune Sim API base URL (default: https://api.sim.dune.com)
# Only change for testing against sandbox environment
# DUNE_SIM_BASE_URL=https://api.sim.dune.com

# Chain provider mode (default: rpc)
# Options:
#   rpc       - Use direct RPC calls (current behavior)
#   dune_sim  - Use Dune Sim API exclusively
#   hybrid    - Use Dune Sim with RPC fallback for unsupported chains
CHAIN_PROVIDER=rpc

# Enable fallback to RPC when Dune Sim fails (only for hybrid mode)
# Default: true
CHAIN_PROVIDER_FALLBACK_ENABLED=true

# Chains that should always use RPC (comma-separated chain IDs)
# Use this if Dune Sim doesn't support a chain you need
# CHAIN_PROVIDER_RPC_ONLY_CHAINS=

# Cache TTL for Dune Sim responses in milliseconds (default: 60000 = 1 minute)
# DUNE_SIM_CACHE_TTL_MS=60000

# Request timeout in milliseconds (default: 10000 = 10 seconds)
# DUNE_SIM_TIMEOUT_MS=10000

# Maximum retry attempts for failed requests (default: 3)
# DUNE_SIM_MAX_RETRIES=3
