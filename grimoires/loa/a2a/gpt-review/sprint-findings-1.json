{
  "verdict": "CHANGES_REQUIRED",
  "summary": "This plan covers all six FRs, but a few missing integration/dependency tasks and some acceptance criteria gaps would likely cause implementation or CI to fail (or ship without actually meeting the PRD intent).",
  "blocking_issues": [
    {
      "location": "Sprint 1 / Task 1.1 (FR-6 naming)",
      "issue": "Task requires presenting 3 names “to the user” and choosing one, but the sprint plan has no mechanism/owner/timebox for making that decision; downstream tasks depend on the chosen name for docs and ceremony.",
      "why_blocking": "If the name isn’t decided early, Sprint 1 can’t complete AC-6.1–6.4 and Sprint 3 Task 3.5 explicitly depends on it; this creates a real risk of Sprint 1 stalling or later rework across multiple artifacts.",
      "fix": "Add an explicit decision task with a timebox and decision owner (e.g., “Decision meeting / async vote closes by day 2”), plus a fallback default name if no decision is reached. Make the chosen name an output artifact (e.g., `spec/protocol-name.md` or a single source-of-truth constant) referenced by docs."
    },
    {
      "location": "Sprint 1 / Tasks 1.2–1.4 (FR-1 graduation)",
      "issue": "Graduation work adds a Prometheus gauge but does not include a task to wire the evaluator into the runtime metrics update path (where existing shadow metrics are computed/emitted).",
      "why_blocking": "You can implement `evaluateGraduation()` and even register a gauge, but without integration into the metrics emission loop/request path, `boundary_graduation_ready` may never be set or may always be default/undefined—failing AC-1.4 in practice and making tests brittle or impossible.",
      "fix": "Add a concrete integration subtask: identify the module that currently increments `shadowTotal/wouldRejectTotal/divergenceTotal` and update it to call `evaluateGraduation()` and set the gauge per context on the same cadence. Acceptance: gauge changes from 0→1 under a simulated-ready state in an integration/unit test."
    },
    {
      "location": "Sprint 1 / Task 1.3 (FR-1 tests)",
      "issue": "Acceptance criteria include “vacuously true when shadowTotal is 0” but Task 1.2 AC-1.1 also requires a 7-day observation window and 72h consecutive clean; these can conflict unless explicitly defined in the evaluator spec.",
      "why_blocking": "Ambiguous/contradictory criteria will cause churn: implementers won’t know whether `shadowTotal=0` should override time windows or still require elapsed time. This can block sign-off and lead to failing tests depending on interpretation.",
      "fix": "Add an explicit rule in the SDD/PRD mapping and in Task 1.2 AC: e.g., “If shadowTotal==0, ready=false (or true) regardless of time windows” OR “shadowTotal==0 short-circuits only divergence criterion but still requires observation/consecutive windows.” Then align Task 1.3 tests to that rule."
    },
    {
      "location": "Sprint 2 / Task 2.2 (FR-3 route integration)",
      "issue": "The plan names several route areas but does not enumerate the exact route files/endpoints and input fields that must be covered, nor does it include an inventory step to ensure all micro-USD entry points are updated.",
      "why_blocking": "This is a classic gap that leads to partial rollout: one missed endpoint means the gateway validation requirement (AC-3.3/3.4) is not actually satisfied, and regressions can slip through because tests may not cover the missed path.",
      "fix": "Add a short “inventory + checklist” task/subtask: grep for `parseBoundaryMicroUsd` (and any other micro-USD parsing helpers) and list all call sites/endpoints; make the checklist part of the PR description. Acceptance: all call sites either use the schema or are explicitly justified as internal-only."
    },
    {
      "location": "Sprint 2 / Task 2.1 (FR-3 schema)",
      "issue": "Schema is required to be mode-aware via `resolveParseMode()`, but there is no task ensuring `resolveParseMode()` is safe to call at request time given the module-level env var caching/cold-restart constraints (ties directly to FR-4).",
      "why_blocking": "If `resolveParseMode()` reads cached env at module init while routes expect runtime changes (or vice versa), you can end up with schema mode diverging from parser mode, violating AC-3.2 and potentially breaking backward compatibility in shadow/legacy mode.",
      "fix": "Add an explicit dependency/coordination step between FR-3 and FR-4: document and enforce that parse mode is fixed at process start (cold restart), and ensure both `resolveParseMode()` and schema creation share the same cached config source. Add a test asserting schema mode matches parser mode under controlled env setup."
    },
    {
      "location": "Sprint 2 / Task 2.5 (FR-4 test)",
      "issue": "“Verify fingerprint emission at startup” is underspecified for a Node/TS module that may emit logs during import; without a defined test harness (spawning a subprocess vs mocking logger), this is likely to be flaky or infeasible.",
      "why_blocking": "Teams often get stuck here: unit tests can’t reliably assert “startup log emitted” without controlling module cache and process env. This can block CI or lead to skipping the test, leaving FR-4 incomplete.",
      "fix": "Specify the test approach in the task: either (a) spawn a node subprocess that imports `config.ts` and capture stdout/stderr, or (b) refactor `emitConfigFingerprint()` to accept an injected logger and test deterministically. Update AC to match the chosen approach."
    },
    {
      "location": "Sprint 3 / Tasks 3.1–3.4 (FR-2 contract testing)",
      "issue": "No task adds the contract validation to CI (provider-side) or defines how consumers will run it beyond README; without wiring, the contract won’t actually prevent drift.",
      "why_blocking": "FR-2’s value is enforcement. If CI isn’t updated to run `spec/contracts/validate.mjs` (and/or the Jest test), the sprint can “complete” files but still fail the PRD intent and the meta-criterion (Bridgebuilder would still flag lack of enforcement).",
      "fix": "Add a task to update the repo’s CI pipeline/package scripts: e.g., `pnpm test` includes `spec/contracts/__tests__` and/or a dedicated `pnpm contract:validate` run in CI. Acceptance: CI fails if an entrypoint is removed/renamed or vectors hash changes without updating the contract."
    },
    {
      "location": "Sprint 3 / Task 3.1 (FR-2 contract spec)",
      "issue": "“Provider version range >=7.9.2” is stated but not tied to an actual source of truth (package.json version? protocol package version? git tag?) and not validated anywhere.",
      "why_blocking": "Implementers won’t know what to put in `contract.json`, and reviewers can’t test it. This can stall Task 3.1/3.4 or lead to a meaningless field that doesn’t satisfy AC-2.x expectations.",
      "fix": "Define the version source explicitly (e.g., `themes/sietch/src/packages/core/package.json` version, or monorepo root version) and add a validation in Task 3.4 that compares contract’s provider range against that source."
    }
  ],
  "question": "",
  "iteration": 1
}
