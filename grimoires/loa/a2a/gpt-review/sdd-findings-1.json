{
  "verdict": "CHANGES_REQUIRED",
  "summary": "Mostly consistent with the PRD, but there are a few concrete places where the design as written will either fail CI (contract/entrypoints) or violate the “schema-only / no runtime change” constraint via dependency build scripts and export assumptions.",
  "blocking_issues": [
    {
      "location": "§3.1.1 New Exports Section (protocol/index.ts) — governance subpath exports",
      "issue": "The barrel re-exports `TASK_TYPES` and `validateTaskCohortUniqueness` from `@0xhoneyjar/loa-hounfour/governance` without verifying they are runtime exports (and not type-only or not exported at all).",
      "why_blocking": "Your contract layer explicitly validates runtime exports via dynamic `import()`. If either symbol is not actually exported at runtime from that entrypoint, `themes/sietch/tests/unit/contract-spec.test.ts` will fail deterministically, blocking release. This is a common failure mode when a symbol exists in TS types but is erased or not re-exported in the built dist.",
      "fix": "Before landing, confirm in the installed provider package that `import('@0xhoneyjar/loa-hounfour/governance')` has own-properties `TASK_TYPES` and `validateTaskCohortUniqueness`. If either is absent, remove it from both `protocol/index.ts` and `contract.json`, or add/restore the runtime export upstream in hounfour v7.11.0 and repin."
    },
    {
      "location": "§3.1.1 and §3.4.1 (contract.json) — root entrypoint symbols",
      "issue": "The SDD assumes `computeScoringPathHash` and `SCORING_PATH_GENESIS_HASH` are exported from the hounfour root entrypoint, and adds them to the root contract entrypoint list, but does not establish that these are actually root exports in v7.11.0 (vs only under `/governance` or `/integrity`).",
      "why_blocking": "If these utilities are not present on the root entrypoint at runtime, contract validation fails. This is especially likely when a project organizes new utilities under a subpath but the consumer expects root re-exports.",
      "fix": "Verify the provider’s actual export surface for v7.11.0 (e.g., `node -e \"import('@0xhoneyjar/loa-hounfour').then(m=>console.log(Object.keys(m)))\"`). If the utilities are not root exports, change freeside to re-export them from the correct subpath and update `contract.json` accordingly (root vs governance entrypoint)."
    },
    {
      "location": "§3.3 FR-4: Evaluation Geometry Type Re-export",
      "issue": "The design claims “evaluation_geometry … no separate export needed; it’s part of the Constraint schema” and only re-exports `NativeEnforcement` type-only from the root. This can fail consumers if `Constraint` (or the schema/type that carries `evaluation_geometry`) is not already exported from the freeside protocol barrel, or if consumers rely on a named export for the literal union.",
      "why_blocking": "This is a schema-adoption cycle; if the goal is “consumer access” to evaluation geometry, but the barrel does not actually expose the updated `Constraint` type/schema, downstream compilation can fail or consumers will be forced into deep imports (breaking the contract intent). This becomes a release blocker if any internal package already expects to import the updated schema from the barrel after the bump.",
      "fix": "Make the exposure explicit: confirm `Constraint` (and its schema, if applicable) is already re-exported from `protocol/index.ts`. If not, add the appropriate `ConstraintSchema`/`Constraint` re-export (runtime + type) and include the runtime schema symbol in `contract.json` if it’s a runtime export. If it is already exported, add an explicit note in the SDD referencing the exact existing export to avoid an incorrect assumption."
    },
    {
      "location": "§3.5.3 Rebuild Script Impact + NFR-2 “Schema Adoption Only”",
      "issue": "The cycle changes the provider pin and triggers `scripts/rebuild-hounfour-dist.sh` postinstall, which can change the runtime artifact shape (rebuilt dist) even if freeside code is “schema-only.” The SDD assumes “tags and SHAs both work as refs” but doesn’t address supply-chain integrity or determinism of the rebuilt output.",
      "why_blocking": "If the rebuild script produces non-deterministic output (timestamps, differing build tool versions, optional deps), CI can become flaky or the contract can validate against a locally rebuilt provider that differs from what other consumers use. More importantly, this violates the PRD’s intent of “schema adoption only” by potentially altering runtime provider code that freeside executes (even if freeside didn’t change its own runtime logic).",
      "fix": "Either (a) stop rebuilding provider dist in freeside for this cycle (consume published dist only), or (b) harden the rebuild to be deterministic and verified: pin build toolchain versions, enforce clean checkout at the exact tag/commit, and add a verification step (e.g., compare built bundle hash against an expected value published by hounfour). At minimum, document the trust boundary: are we executing rebuilt provider code in production or only in CI?"
    },
    {
      "location": "§4.2 ADR-001 Import Guard Test (protocol-conformance.test.ts)",
      "issue": "The proposed guard relies on “grep codebase” and allows “type-only imports,” but TypeScript `import type { GovernanceTaskType }` still appears in source text and will be matched by grep; conversely, runtime imports can be introduced via re-export chains without a direct textual import in routing files.",
      "why_blocking": "AC-1.6 is a hard constraint (“No governance TaskType in routing/mapping/switch code paths”). A brittle grep-based test can both false-fail (blocking CI) and false-pass (allowing a real violation), undermining the acceptance criteria and risking accidental runtime coupling in later refactors.",
      "fix": "Implement the guard using AST-based analysis (ts-morph / TypeScript compiler API) to: (1) identify imports of `GovernanceTaskType` (value or type) in a defined set of routing/mapping modules, and (2) detect any identifier usage of `GovernanceTaskType` in those modules regardless of import style. Alternatively, enforce at the barrel level: do not export any governance `TaskType` under the name `TaskType`, and add a unit test that `protocol.TaskType` is exactly the routing-policy one (type identity check via `expectTypeOf`), plus a targeted module list check for forbidden identifiers."
    }
  ],
  "question": "",
  "iteration": 1
}
