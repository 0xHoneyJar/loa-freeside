{
  "verdict": "CHANGES_REQUIRED",
  "summary": "As written, this PRD will likely ship a financially inconsistent system (referral share vs existing 3-way split), an unfundable/undefined Score rewards liability, and a payout flow that can’t be reconciled safely with a credit ledger without clarifying what “credits” represent and how NOWPayments is funded.",
  "blocking_issues": [
    {
      "location": "FR-3.2 + Section 9 (Revenue Flow example) + existing “3-way split with governance”",
      "issue": "The revenue-share math is internally inconsistent: the example applies the 3-way split percentages (5/70/25) to the remaining 90% after the 10% referrer cut, which changes the effective split vs the existing governed 3-way split.",
      "why_blocking": "If the existing 3-way split is a governed invariant (commons/community/foundation percentages of total revenue), then applying it to the post-referral remainder silently reduces each party’s share and will be perceived as a governance violation or a bug. If instead the intent is to keep the 3-way split as percentages of the remainder, then governance parameters and reporting must reflect that (and historical comparisons break). Either way, implementers can build the wrong distribution logic and misallocate funds.",
      "fix": "Choose and specify one of: (A) referrer share is an additional 4th slice of total revenue and the 3-way split remains percentages of total (so total bps must sum to 10000 including referrer), or (B) referrer share is taken first and the 3-way split is defined over the remainder (explicitly redefine governance parameters as “of remainder”). Update Section 9 example and add an invariant: SUM(all party allocations) == inference_revenue (after rounding rules)."
    },
    {
      "location": "FR-2.1 vs FR-2.2 and User Journey (two $5 bonuses implied)",
      "issue": "Signup bonus trigger is contradictory: FR-2.1 says bonus on first qualifying action when referee creates dNFT OR purchases credits, but the journey implies both events each trigger a $5 bonus; FR-2.2 says only one bonus per referee.",
      "why_blocking": "This will cause either overpayment (two bonuses) or under-delivery vs BD messaging and user expectations. It also affects budget caps and abuse risk modeling; the team can’t implement or test correctly without a single rule.",
      "fix": "Decide: (A) one-time bonus per referee on first qualifying action (dNFT creation OR first purchase), or (B) two separate bonuses with separate budgets/ids (e.g., $5 on first dNFT + $5 on first purchase). Update FR-2.2, journey, and campaign budget model accordingly."
    },
    {
      "location": "FR-6 (Creator Payouts) + NFR-2 Payout solvency + Product Context (credits ledger) + NOWPayments",
      "issue": "Payouts are specified as “credit burn → NOWPayments crypto disbursement” without defining the economic backing of credits and the funding source for NOWPayments payouts (who holds the crypto/fiat, when it’s acquired, and how credit liabilities map to real funds).",
      "why_blocking": "A credit ledger can represent prepaid value, promotional value, or internal-only utility. Burning credits does not automatically produce external funds to pay out. Without a defined backing model, the system can become insolvent (users withdraw promotional credits) or impossible to reconcile (no ledger link between collected payments and payout funding). This is a fundamental feasibility gap for “creator payouts.”",
      "fix": "Specify credit classes and withdrawal eligibility: e.g., only “earned_referral_revenue” credits are withdrawable; “promo/campaign” credits are non-withdrawable. Define a treasury/funding account and the exact ledger flow: payment collection → foundation/treasury balance increases → referrer earnings accrue as withdrawable balance → payout debits treasury and debits creator withdrawable balance. Add invariants tying total withdrawable balances to treasury backing (or explicitly accept float and define limits)."
    },
    {
      "location": "FR-5 (Score-Weighted Rewards Pool) + Section 9 (pool funded from foundation share or dedicated allocation) + NFR-2 Bounded liability",
      "issue": "Score rewards pool funding and liability are not actually bounded in the requirements: pool_size is “configurable” but not tied to a budgeted source-of-truth account/pool with enforcement, and it’s unclear whether these rewards are withdrawable or just spendable credits.",
      "why_blocking": "If Score rewards mint spendable credits without a hard budget and without isolating them as non-withdrawable, you create open-ended liability and/or a path to drain treasury via payouts. Even if non-withdrawable, uncontrolled minting can distort unit economics and reporting. Implementers cannot safely ship without a concrete budget enforcement mechanism analogous to FR-2.5.",
      "fix": "Make Score rewards a campaign with an explicit budget cap and a defined funding source (e.g., “foundation:score_rewards” pool funded by X% of foundation revenue per period, or a fixed monthly allocation). Enforce: distributed_amount <= available_budget at distribution time. Explicitly mark Score reward credits as withdrawable or non-withdrawable (recommended: non-withdrawable unless separately funded)."
    },
    {
      "location": "FR-5.1 (Score import) + FR-5.2 (account_score/total_score_sum) + Personas (holder engagement across collections)",
      "issue": "The PRD assumes a stable mapping of “account → score” but does not define identity resolution between Score’s notion of a holder (wallets across chains? multiple wallets per user? Discord/Telegram identities?) and Arrakis “account,” nor how to prevent Sybil via wallet-splitting to farm proportional rewards.",
      "why_blocking": "Without a defined identity binding, distributions will be wrong (rewards to the wrong accounts or missed accounts) and trivially gameable (split holdings across many wallets to bypass thresholds or manipulate eligibility). This undermines the core BD promise and can cause immediate loss of trust.",
      "fix": "Define the canonical identifier for Score rewards (e.g., EVM address) and how it maps to Arrakis accounts (one account can link N wallets; rewards accrue per wallet or per account). Specify anti-Sybil rule: either distribute per wallet (acceptable but then thresholds/eligibility must be wallet-based) or require wallet linking + uniqueness constraints + minimum score per linked wallet/account. Add requirements for verification of wallet ownership (sign message) before eligibility."
    },
    {
      "location": "FR-3.3 (12-month attribution window) + FR-1.5 (binding permanent) + revenue finalization path",
      "issue": "Attribution window is defined, but there is no requirement for how the system determines eligibility at the moment of revenue finalization (e.g., using referral_registration.created_at vs first qualifying action vs first payment) and how it behaves under clock skew/backfills/replays.",
      "why_blocking": "Revenue distribution is typically executed in a finalization pipeline; if eligibility logic isn’t precisely defined and idempotent, you can mispay or double-pay referrers during reprocessing, backfills, or delayed finalization—this is a financial correctness failure.",
      "fix": "Specify the exact timestamp anchor for the 12-month window (recommended: referral_registration.created_at) and require idempotent distribution keyed by (inference_charge_id, rule_version). Add acceptance tests for replay/backfill: re-finalizing the same inference event must not create additional referrer allocations."
    },
    {
      "location": "FR-6.5–FR-6.6 (NOWPayments payout execution + callback reconciliation) + NFR-4 (2s p99 includes NOWPayments call)",
      "issue": "The payout flow mixes synchronous API latency targets with an external provider and doesn’t specify the required NOWPayments payout primitives (quote/rate lock, fee handling, idempotency keys, webhook authenticity verification).",
      "why_blocking": "Without idempotency and webhook verification, payouts can be duplicated or spoofed. Without fee/rate handling, the system can underpay/overpay or fail reconciliation. The 2s p99 requirement is likely unachievable if it includes provider calls, leading to timeouts and inconsistent states.",
      "fix": "Make payout request asynchronous: API creates payout_request (pending) and enqueues a job; job calls NOWPayments with idempotency key; webhook is verified (HMAC/secret) and updates status. Specify who pays network/provider fees (deduct from amount vs charged to treasury) and whether amount_micro is “gross” or “net received.” Adjust NFR-4 to exclude external call latency from API p99."
    }
  ],
  "question": "",
  "iteration": 1
}
