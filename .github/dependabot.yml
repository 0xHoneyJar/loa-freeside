# Dependabot Configuration for Automated Dependency Updates
# LOW-004: Security fix for automated dependency monitoring
# Sprint 75: MED-1 - Dependency vulnerability scanning
# Sprint SEC-1: H-1 - Automated security monitoring for dependencies
#
# This configuration enables Dependabot to automatically check for and create
# pull requests for dependency updates across all services.

version: 2
updates:
  # Worker Service (Discord bot event processing - Sprint SEC-1)
  - package-ecosystem: "npm"
    directory: "/apps/worker"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 10
    reviewers:
      - "0xHoneyJar"
    labels:
      - "dependencies"
      - "security"
      - "worker"
    groups:
      development-dependencies:
        dependency-type: "development"
        patterns:
          - "*"
      production-dependencies:
        dependency-type: "production"
        patterns:
          - "*"
    versioning-strategy: "increase"
    rebase-strategy: "auto"
    commit-message:
      prefix: "chore(deps)"
      prefix-development: "chore(deps-dev)"
      include: "scope"
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

  # Gateway Service (Rust - future Twilight gateway)
  - package-ecosystem: "cargo"
    directory: "/apps/gateway"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "security"
      - "gateway"
      - "rust"
    commit-message:
      prefix: "chore(deps)"

  # Sietch Service (main application - Sprint 75)
  - package-ecosystem: "npm"
    directory: "/sietch-service"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 10
    reviewers:
      - "0xHoneyJar"
    labels:
      - "dependencies"
      - "security"
      - "sietch-service"
    # Group non-security updates to reduce PR noise
    groups:
      development-dependencies:
        dependency-type: "development"
        patterns:
          - "*"
      production-dependencies:
        dependency-type: "production"
        patterns:
          - "*"
    # Allow both direct and indirect dependency updates
    versioning-strategy: "increase"
    # Automatically rebase pull requests when base branch is updated
    rebase-strategy: "auto"
    # Commit message prefix
    commit-message:
      prefix: "chore(deps)"
      prefix-development: "chore(deps-dev)"
      include: "scope"
    # Ignore major updates that may break compatibility
    ignore:
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

  # Integration layer (Discord bot, Linear integration, webhooks)
  - package-ecosystem: "npm"
    directory: "/integration"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 10
    reviewers:
      - "0xHoneyJar"
    labels:
      - "dependencies"
      - "security"
      - "integration"
    # Group non-security updates to reduce PR noise
    groups:
      development-dependencies:
        dependency-type: "development"
        patterns:
          - "*"
      production-dependencies:
        dependency-type: "production"
        patterns:
          - "*"
    # Allow both direct and indirect dependency updates
    versioning-strategy: "increase"
    # Automatically rebase pull requests when base branch is updated
    rebase-strategy: "auto"
    # Commit message prefix
    commit-message:
      prefix: "chore(deps)"
      prefix-development: "chore(deps-dev)"
      include: "scope"

  # Root package.json (if exists)
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 5
    labels:
      - "dependencies"
      - "security"
    commit-message:
      prefix: "chore(deps)"

  # Docker base images
  - package-ecosystem: "docker"
    directory: "/integration"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "10:00"
    open-pull-requests-limit: 3
    labels:
      - "dependencies"
      - "docker"
      - "security"
    commit-message:
      prefix: "chore(docker)"

  # GitHub Actions
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "monthly"
      day: "monday"
      time: "09:00"
    open-pull-requests-limit: 3
    labels:
      - "dependencies"
      - "ci"
    commit-message:
      prefix: "chore(ci)"

# Security Updates:
# - Dependabot will automatically create PRs for security updates regardless of schedule
# - Security updates are prioritized and opened immediately when detected
# - Critical vulnerabilities will open PRs even if open-pull-requests-limit is reached
#
# To customize for your team:
# 1. Replace "your-team" with your GitHub team name or individual usernames
# 2. Adjust schedule timing to match your team's workflow
# 3. Add assignees if you want automatic PR assignments
# 4. Configure ignore rules if specific packages should not be updated
#
# Example ignore configuration (add to any update block):
# ignore:
#   - dependency-name: "package-name"
#     versions: ["1.x", "2.x"]
#   - dependency-name: "another-package"
#     update-types: ["version-update:semver-major"]
